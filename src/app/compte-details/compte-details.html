<div class="cyber-viewport fade-in" *ngIf="compte$ | async as compte">
  <div class="container py-4">

    <div class="glass-panel mb-4 p-3 d-flex justify-content-between align-items-center border-neon-blue">
      <div>
        <h2 class="cyber-title-sm mb-0">DOSSIER_COMPTE: <span class="highlight">{{ compte.id }}</span></h2>
        <span class="status-indicator">
          <span class="pulse-dot" [class.bg-activated]="compte.statut === 'ACTIVATED'" [class.bg-suspended]="compte.statut === 'SUSPENDED'"></span>
          SYSTEM_{{ compte.statut }}
        </span>
      </div>
      <div class="type-tag">{{ compte.type }}</div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="glass-panel h-100 p-4">
          <h4 class="section-title"><i class="bi bi-cpu-fill me-2"></i> DATA_SPECIFICATIONS</h4>
          <hr class="cyber-divider">

          <div class="data-row">
            <span class="label">ID_SYSTÈME</span>
            <span class="value">{{ compte.id }}</span>
          </div>

          <div class="data-row">
            <span class="label">SOLDE_ACTUEL</span>
            <span class="value balance-neon">{{ compte.solde | number:'1.2-2' }} <small>DH</small></span>
          </div>

          <div class="data-row" *ngIf="compte.type === 'COURANT'">
            <span class="label text-warning">DÉCOUVERT_AUTORISÉ</span>
            <span class="value text-warning">{{ compte.decouvert || 0 }} DH</span>
          </div>

          <div class="data-row" *ngIf="compte.type === 'EPARGNE'">
            <span class="label text-info">TAUX_INTÉRÊT_ANNUEL</span>
            <span class="value text-info">{{ compte.tauxInteret || 0 }} %</span>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="glass-panel p-4 border-neon-purple">
          <h4 class="section-title"><i class="bi bi-lightning-charge-fill me-2"></i> NEW_TRANSACTION</h4>

          <form [formGroup]="operationForm" (ngSubmit)="submitOperation(compte.id)" class="mt-3">
            <div class="mb-3">
              <label class="cyber-label">TYPE_OPÉRATION</label>
              <select class="cyber-select" formControlName="type">
                <option value="DEBIT">DÉBIT_TRANSFERT</option>
                <option value="CREDIT">CRÉDIT_DÉPÔT</option>
                <option value="VIREMENT">VIREMENT_INTERNE</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="cyber-label">MONTANT_FLUX (DH)</label>
              <input type="number" class="cyber-input" formControlName="montant" placeholder="0.00">
            </div>

            <div class="mb-3">
              <label class="cyber-label">DESCRIPTION_LOG</label>
              <input type="text" class="cyber-input" formControlName="description" placeholder="Mémo opération...">
            </div>

            <div class="mb-3 fade-in" *ngIf="operationForm.value.type === 'VIREMENT'">
              <label class="cyber-label text-info">ID_DESTINATAIRE_CIBLE</label>
              <input type="text" class="cyber-input border-info" formControlName="destinationId" placeholder="ID Compte">
            </div>

            <button class="btn-cyber-action w-100 mt-2" [disabled]="compte.statut === 'SUSPENDED'">
              EXÉCUTER_LA_TRANSACTION <i class="bi bi-shield-check ms-2"></i>
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="glass-panel p-4">
          <h4 class="section-title mb-4"><i class="bi bi-clock-history me-2"></i> TRANSACTION_LOGS</h4>
          <div class="table-responsive">
            <table class="table cyber-table" *ngIf="operations$ | async as operations">
              <thead>
              <tr>
                <th>TIMESTAMP</th>
                <th>OP_TYPE</th>
                <th>DESCRIPTION</th>
                <th class="text-end">AMOUNT_DH</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let op of operations">
                <td class="text-muted">{{ op.dateOperation | date:'dd/MM/yyyy | HH:mm' }}</td>
                <td><span class="op-badge" [attr.data-type]="op.type">{{ op.type }}</span></td>
                <td class="small">{{ op.description }}</td>
                <td class="text-end fw-bold" [class.text-danger]="op.type === 'DEBIT'" [class.text-success]="op.type === 'CREDIT'">
                  {{ op.type === 'DEBIT' ? '-' : '+' }}{{ op.montant | number:'1.2-2' }}
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
